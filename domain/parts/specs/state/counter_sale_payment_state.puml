@startuml CounterSaleStateDiagram

title Counter Sale (Immediate Payment)

' Define the starting point
[*] --> CREATED

' 1. Transaction Creation & Initiation
state CREATED : Order/Ticket is opened

' 2. Payment Attempt (Immediate)
state PENDING
state PROCESSING
state REQUIRES_ACTION : Pin Pad / Signature

CREATED --> PENDING : Payment method selected (e.g., Credit Card swipe)
PENDING --> PROCESSING : Sending request to payment processor
PROCESSING --> REQUIRES_ACTION : User input needed (PIN, tap, signature)
REQUIRES_ACTION --> PROCESSING : User input received

' 3. Authorization Gates
state APPROVED
state PAID : Funds are captured
state SUCCEEDED
state COMPLETED

PROCESSING --> APPROVED : Authorization granted
APPROVED --> PAID : Funds captured instantly (typical for counter sales)
PAID --> SUCCEEDED : High-level success confirmation
SUCCEEDED --> COMPLETED : Transaction closed and finalized

' 4. Failure & Reversal States
state FAILED
state DENIED
state REJECTED
state VOIDED
state REFUNDED

PROCESSING --> FAILED : General communication error
PROCESSING --> DENIED : Card denied by bank
PROCESSING --> REJECTED : Processor risk rejection

' 5. Post-Completion Actions (Rare for parts, but possible)
PAID --> VOIDED : Immediate void (e.g., mistaken charge)
PAID --> REFUNDED : Subsequent return of part

' 6. Terminal End States
FAILED --> [*]
DENIED --> [*]
REJECTED --> [*]
VOIDED --> [*]
REFUNDED --> [*]
COMPLETED --> [*]

@enduml